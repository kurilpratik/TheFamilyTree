---
import { sanityClient } from '../lib/sanityClient';

const BLOGPOSTS_QUERY = `*[_type == "blogPost"] {
  _id,
  title,
  description,
  image,
  author -> {
    name,
    image},
  publishedAt
}`;

const blogPosts = await sanityClient.fetch(BLOGPOSTS_QUERY);

// Dummy blog data
// const blogPosts = [
//   {
//     title: 'Five Ways to Connect with Your Adolescent',
//     description:
//       'There are many words which adults use to describe their teenagers but the phrases that usually stand out to us are: ‘angsty’ ‘rebellious’ ‘cold’ ‘withdrawn’ ‘manipulative’. The words are not novel. They have been used generationally to describe a challenging phase of development where the child moves from being a child to becoming a young adult.',
//     image: null, // Optional image
//     author: {
//       name: 'Ambika Singh',
//       image: '/assets/image-3-452x570.jpg',
//     },
//     link: '#',
//   },
//   {
//     title: 'ADVANCED ANALYTICS HELPS A MINING COMPANY IMPROVE QUALITY AND REDUCE COSTS',
//     description:
//       'Duis aute irure dolor in reprehenderit in voluptate velit esse cillum dolore eu fugiat nulla pariatur. Excepteur sint occaecat cupidatat non proident, sunt in culpa qui officia deserunt mollit anim id est laborum.',
//     image: '/assets/image-4-452x570.jpg', // Optional image
//     author: {
//       name: 'Sarah Johnson',
//       image: '/assets/image-4-452x570.jpg',
//     },
//     link: '#',
//   },
//   {
//     title: "A TECHNOLOGY COMPANY'S TRANSFORMATION RESTORES ITS GROWTH TRAJECTORY",
//     description:
//       'Sed ut perspiciatis unde omnis iste natus error sit voluptatem accusantium doloremque laudantium, totam rem aperiam, eaque ipsa quae ab illo inventore veritatis et quasi architecto beatae vitae dicta sunt explicabo.',
//     image: '/assets/image-3-452x570.jpg', // Optional image
//     author: {
//       name: 'Michael Chen',
//       image: '/assets/image-3-452x570.jpg',
//     },
//     link: '#',
//   },
//   {
//     title: 'A B2B FIBER COMPANY REINVENTS ITS COMMERCIAL OPERATIONS',
//     description:
//       'Nemo enim ipsam voluptatem quia voluptas sit aspernatur aut odit aut fugit, sed quia consequuntur magni dolores eos qui ratione voluptatem sequi nesciunt. Neque porro quisquam est, qui dolorem ipsum quia dolor sit amet.',
//     image: null, // Optional image - this one has no image
//     author: {
//       name: 'Emily Davis',
//       image: '/assets/image-4-452x570.jpg',
//     },
//     link: '#',
//   },
// ];
---

<section id="blog" class="container">
  <h3>The Family Tree Blog</h3>
  <div class="blog-posts">
    {
      blogPosts.map((post: any) => (
        <article class="blog-post">
          <div class="blog-post-content">
            <h2 class="blog-title">{post.title}</h2>
            <p class="blog-description">{post.description}</p>
            <div class="blog-author">
              <img src={post.author.image} alt={post.author.name} class="author-image" />
              <span class="author-name">{post.author.name}</span>
            </div>
            <a href={post.link} class="read-more">
              Read more
            </a>
          </div>
          {post.image && (
            <div class="blog-image-wrapper">
              <img src={post.image} alt={post.title} class="blog-image" />
            </div>
          )}
        </article>
      ))
    }
  </div>
</section>

<style lang="scss">
  @import '../styles/basic';
  #blog {
    padding-block: 10rem;
    padding-block-end: 5rem;
    background-color: #fff;

    h3 {
      text-align: center;
    }

    .blog-posts {
      display: flex;
      flex-direction: column;
      gap: 0;
      width: 100%;
      margin-top: 4rem;
    }

    .blog-post {
      display: flex;
      flex-direction: row;
      gap: 4rem;
      align-items: flex-start;
      padding-block: 3rem;
      width: 100%;
      border-top: 1px solid #e0e0e0;

      &:first-child {
        border-top: none;
        padding-top: 0;
      }

      &:last-child {
        padding-bottom: 0;
      }

      @include mobile {
        flex-direction: column;
        gap: 2rem;
        padding-block: 2rem;
      }

      @include tablet {
        flex-direction: column;
        gap: 2rem;
      }
    }

    .blog-post-content {
      flex: 1;
      display: flex;
      flex-direction: column;
      gap: 1.5rem;
      min-width: 0;
      max-width: 100%;

      @include mobile {
        gap: 1.25rem;
      }
    }

    .blog-title {
      font-size: 1.25rem;
      font-weight: 700;
      text-transform: uppercase;
      color: #1a1a1a;
      margin: 0;
      line-height: 1.4;
      letter-spacing: 0.5px;

      @include mobile {
        font-size: 1.1rem;
        line-height: 1.3;
      }
    }

    .blog-description {
      font-size: 1rem;
      line-height: 1.7;
      color: #4a4a4a;
      opacity: 0.9;
      margin: 0;

      @include mobile {
        font-size: 0.95rem;
        line-height: 1.6;
      }
    }

    .blog-author {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      margin-top: 0.5rem;

      .author-image {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        object-fit: cover;
        flex-shrink: 0;

        @include mobile {
          width: 35px;
          height: 35px;
        }
      }

      .author-name {
        font-size: 0.95rem;
        color: #333;
        font-weight: 500;

        @include mobile {
          font-size: 0.9rem;
        }
      }
    }

    .read-more {
      font-size: 1rem;
      color: #1a1a1a;
      text-decoration: underline;
      margin-top: 0.5rem;
      display: inline-block;
      width: fit-content;
      transition: opacity 0.3s ease;

      &:hover {
        opacity: 0.7;
        cursor: pointer;
      }

      @include mobile {
        font-size: 0.95rem;
      }
    }

    .blog-image-wrapper {
      flex: 0 0 auto;
      width: 450px;
      height: 320px;
      overflow: hidden;

      @include mobile {
        width: 100%;
        height: 250px;
        order: -1; // Show image first on mobile
      }

      @include tablet {
        width: 100%;
        height: 300px;
        order: -1; // Show image first on tablet
      }
    }

    .blog-image {
      width: 100%;
      height: 100%;
      object-fit: cover;
      display: block;
    }
  }
</style>
